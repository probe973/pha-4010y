<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Question Quiz</title>

    <!-- Link to your Font Awesome stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- MathJax for rendering LaTeX -->
    <script type="text/javascript" id="MathJax-script">
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Embedded CSS from your provided code. No additional styling has been added. -->
    <style>
        .quiz-container {
            padding: 20px;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 20px;
            background-color: #f0f0f0;
            border-radius: 8px;
            font-size: 0.9em;
            color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .status-bar span {
            font-weight: bold;
            color: #45ac8b;
        }
        .question-number {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #45ac8b;
            text-align: left;
        }
        .question-text {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.8;
            text-align: left;
        }
        .input-group {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 20px;
        }
        .input-group input {
            padding: 10px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 8px;
            flex-grow: 1;
            margin-right: 10px;
        }
        .input-group span {
            font-size: 1.1em;
            color: #666;
        }
        .feedback-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            display: none;
        }
        .feedback-correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .feedback-incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .button-group {
            text-align: center;
            margin-top: 30px;
        }
        .button-group button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 0 10px;
        }
        .button-group button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        .button-group button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
        }
        .navbar, .content {
            box-sizing: border-box;
            padding: 20px;
        }
        .content {
            max-width: 800px;
            margin: 40px auto;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        h1 {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="/index.html" class="navbar-link">Home</a>
        <span class="navbar-title">Random Question Quiz</span>
    </div>
    <div class="content">
        <h1>Random Question Quiz</h1>
        <div class="quiz-container">
            <div class="status-bar">
                <span>Question: <span id="current-question-num">1</span> of <span id="total-questions">10</span></span>
                <span>Score: <span id="current-score">0</span></span>
            </div>
            <div class="question-box">
                <p class="question-number" id="question-number-display"></p>
                <p class="question-text" id="question-text">Loading quiz questions...</p>
            </div>
            <div class="input-group">
                <input type="text" id="answer-input" placeholder="Enter your answer">
                <span id="units-text"></span>
            </div>
            <div id="feedback-message" class="feedback-message"></div>
            <div class="button-group">
                <button id="check-btn">Check Answer</button>
                <button id="next-btn" disabled>Next Question</button>
                <button id="restart-btn" style="display: none;">Restart Quiz</button>
            </div>
        </div>
    </div>
    <script>
        let quizData = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestions = 10;
        
        const questionNumDisplay = document.getElementById('current-question-num');
        const scoreDisplay = document.getElementById('current-score');
        const questionNumberDisplay = document.getElementById('question-number-display');
        const questionTextElement = document.getElementById('question-text');
        const answerInput = document.getElementById('answer-input');
        const unitsTextElement = document.getElementById('units-text');
        const feedbackMessage = document.getElementById('feedback-message');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        async function loadQuizData() {
            try {
                // Get the file name from the URL query parameter
                const urlParams = new URLSearchParams(window.location.search);
                const fileName = urlParams.get('file');

                if (!fileName) {
                    questionTextElement.textContent = "Error: No quiz file specified in the URL.";
                    return;
                }

                // Correctly construct the full path using the 'uploaded:' protocol and the dynamic file name
                const filePath = `uploaded:rq_conversion_units.json`;
                
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                
                shuffleArray(data);
                quizData = data.slice(0, totalQuestions);
                initializeQuiz();

            } catch (error) {
                questionTextElement.textContent = `Error loading quiz: ${error.message}. Please check the file path and name.`;
                console.error('Error fetching quiz data:', error);
            }
        }

        function initializeQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            scoreDisplay.textContent = score;
            restartBtn.style.display = 'none';
            checkBtn.style.display = 'inline-block';
            nextBtn.style.display = 'inline-block';
            answerInput.disabled = false;
            answerInput.value = '';
            feedbackMessage.style.display = 'none';
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex < totalQuestions) {
                const currentQuestion = quizData[currentQuestionIndex];
                questionNumDisplay.textContent = currentQuestionIndex + 1;
                questionNumberDisplay.textContent = `Question ${currentQuestionIndex + 1}:`;
                questionTextElement.innerHTML = currentQuestion.Question;
                unitsTextElement.textContent = currentQuestion.Units || '';
                answerInput.value = '';
                answerInput.focus();
                
                if (window.MathJax) {
                    MathJax.typesetPromise();
                }

                feedbackMessage.style.display = 'none';
                checkBtn.disabled = false;
                nextBtn.disabled = true;
                answerInput.disabled = false;
            } else {
                questionTextElement.textContent = `Quiz Complete! You scored ${score} out of ${totalQuestions}.`;
                questionNumberDisplay.textContent = '';
                answerInput.style.display = 'none';
                unitsTextElement.style.display = 'none';
                checkBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                restartBtn.style.display = 'block';
            }
        }

        function checkAnswer() {
            const userAnswer = answerInput.value.trim();
            const currentQuestion = quizData[currentQuestionIndex];
            
            if (userAnswer === '') {
                feedbackMessage.textContent = 'Please enter an answer.';
                feedbackMessage.className = 'feedback-message feedback-incorrect';
                feedbackMessage.style.display = 'block';
                return;
            }
            
            const isCorrect = Math.abs(parseFloat(userAnswer) - parseFloat(currentQuestion.Answer)) < 0.0001;

            if (isCorrect) {
                feedbackMessage.textContent = 'Correct!';
                feedbackMessage.className = 'feedback-message feedback-correct';
                score++;
                scoreDisplay.textContent = score;
                answerInput.disabled = true;
            } else {
                feedbackMessage.textContent = `Incorrect. The correct answer is ${currentQuestion.Answer} ${currentQuestion.Units}.`;
                feedbackMessage.className = 'feedback-message feedback-incorrect';
            }

            feedbackMessage.style.display = 'block';
            checkBtn.disabled = true;
            nextBtn.disabled = false;
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        checkBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', loadQuizData);

        answerInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter' && !checkBtn.disabled) {
                checkAnswer();
            }
        });

        document.addEventListener('DOMContentLoaded', loadQuizData);
    </script>
</body>
</html>
